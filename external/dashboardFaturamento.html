<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Financeiro | Portal MRK</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>

    <style>
        :root {
            --mrk-blue: #0B46AC;
            --mrk-green: #2e7d32;
            --mrk-amber: #ffa000;
            --mrk-red: #d32f2f;
            --bg-gray: #F4F7F6;
        }

        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-gray); }
        h1, h2, h3, .kanit { font-family: 'Kanit', sans-serif; }

        .mrk-card {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-top: 3px solid var(--mrk-blue);
        }

        .card-green { border-top-color: var(--mrk-green); }
        .card-amber { border-top-color: var(--mrk-amber); }

        label { font-family: 'Kanit', sans-serif; font-size: 12px; color: #666; margin-bottom: 4px; display: block; }
        .form-control {
            height: 38px; border-radius: 6px; border: 1px solid #d1d5db; padding: 0 10px; font-size: 14px; width: 100%;
        }

        .btn-range {
            padding: 6px 12px; background: #fff; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 12px;
            font-weight: 600; color: #4b5563; cursor: pointer;
        }
        .btn-range:hover { border-color: var(--mrk-blue); color: var(--mrk-blue); }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: 4px; color: transparent !important;
        }
        @keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        .select2-container--default .select2-selection--multiple { border: 1px solid #d1d5db; border-radius: 0.375rem; min-height: 38px; }

        .table-ranking thead th {
            background-color: #f8f9fa; color: var(--mrk-blue); font-family: 'Kanit'; font-size: 11px;
            text-transform: uppercase; padding: 8px;
        }
    </style>
</head>

<body class="text-gray-800">
<div class="p-6 mx-auto">

    <div class="mrk-card p-4 mb-6" style="border-top-width: 2px;">
        <div class="flex items-end gap-4 flex-wrap">
            <div class="flex-1 min-w-[300px]">
                <label>Período de Análise</label>
                <div class="flex gap-2">
                    <button onclick="setRange('hoje')" class="btn-range">Hoje</button>
                    <button onclick="setRange('ontem')" class="btn-range">Ontem</button>
                    <button onclick="setRange('7dias')" class="btn-range">7 Dias</button>
                    <button onclick="setRange('mes')" class="btn-range">30 Dias</button>
                </div>
            </div>
            <div class="w-40">
                <label>Início</label>
                <input type="date" id="startDate" onchange="fetchData()" class="form-control" />
            </div>
            <div class="w-40">
                <label>Fim</label>
                <input type="date" id="endDate" onchange="fetchData()" class="form-control" />
            </div>
            <div class="w-56">
                <label>Grupo Econômico</label>
                <select id="filtroGrupo" class="form-control"></select>
            </div>
            <div class="flex-1 min-w-[250px]">
                <label>Lojas (Multiseleção)</label>
                <select id="filtroLoja" multiple class="w-full"></select>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">

        <div class="mrk-card p-4">
            <div class="flex items-center gap-3">
                <iconify-icon icon="icon-park-outline:sales-report" class="text-blue-600 text-2xl"></iconify-icon>
                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-wider">Faturamento Total</div>
            </div>
            <div class="text-xl font-bold mt-2 kanit" id="faturamentoTotal">R$ 0,00</div>
        </div>

        <div class="mrk-card p-4 card-amber">
            <div class="flex items-center gap-3">
                <iconify-icon icon="icon-park-outline:tag-one" class="text-amber-600 text-2xl"></iconify-icon>
                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-wider">Descontos</div>
            </div>
            <div class="text-xl font-bold mt-2 kanit" id="descontos">R$ 0,00</div>
        </div>

        <div class="mrk-card p-4 card-amber">
            <div class="flex items-center gap-3">
                <iconify-icon icon="icon-park-outline:hand-down" class="text-amber-600 text-2xl"></iconify-icon>
                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-wider">Taxa de Serviço</div>
            </div>
            <div class="text-xl font-bold mt-2 kanit" id="taxaServico">R$ 0,00</div>
        </div>

        <div class="mrk-card p-4 card-green">
            <div class="flex items-center gap-3">
                <iconify-icon icon="icon-park-outline:finance" class="text-green-600 text-2xl"></iconify-icon>
                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-wider">Faturamento Líquido</div>
            </div>
            <div class="text-xl font-bold mt-2 kanit" id="faturamentoLiquido">R$ 0,00</div>
        </div>

        <div class="mrk-card p-4">
            <div class="flex items-center gap-3">
                <iconify-icon icon="icon-park-outline:peoples" class="text-blue-600 text-2xl"></iconify-icon>
                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-wider">Nº Clientes</div>
            </div>
            <div class="text-xl font-bold mt-2 kanit" id="numClientes">0</div>
        </div>

        <div class="mrk-card p-4">
            <div class="flex items-center gap-3">
                <iconify-icon icon="icon-park-outline:ticket" class="text-blue-600 text-2xl"></iconify-icon>
                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-wider">Ticket Médio</div>
            </div>
            <div class="text-xl font-bold mt-2 kanit" id="ticketMedio">R$ 0,00</div>
        </div>

    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-6">
        <div class="lg:col-span-4 mrk-card p-5 flex flex-col">
            <h2 class="text-md font-bold mb-4 uppercase">Ranking de Produtos</h2>
            <div class="overflow-y-auto flex-1 mb-4">
                <table class="w-full text-xs table-ranking">
                    <thead><tr class="border-b"><th class="text-left">Pos</th><th class="text-left">Produto</th><th class="text-right" id="headerTipo">Qtd</th></tr></thead>
                    <tbody id="rankingTableBody"></tbody>
                </table>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <button id="btnMais" class="btn-range bg-blue-700 text-white border-none">Mais Vendidos</button>
                <button id="btnMenos" class="btn-range">Menos Vendidos</button>
                <button id="btnQtd" class="btn-range bg-blue-700 text-white border-none">Quantidade</button>
                <button id="btnValor" class="btn-range">Valor (R$)</button>
            </div>
        </div>

        <div class="lg:col-span-8 mrk-card p-5">
            <h2 class="text-md font-bold mb-4 uppercase">Faturamento Diário Consolidado</h2>
            <div id="chartFaturamentoDiario" style="width: 100%; height: 380px;"></div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-10 gap-6 mb-6">
        <div class="mrk-card p-6 lg:col-span-6 h-[540px]">
            <h2 class="text-md font-bold mb-4 uppercase">Participação das Unidades</h2>
            <div id="main" class="w-full h-[450px]"></div>
        </div>

        <div class="lg:col-span-4 flex flex-col gap-6">
            <div class="mrk-card p-6 h-[260px]">
                <h2 class="text-sm font-bold mb-2 uppercase">Modos de Venda</h2>
                <div id="chartModosVenda" class="w-full h-full"></div>
            </div>
            <div class="mrk-card p-6 h-[256px]">
                <h2 class="text-sm font-bold mb-2 uppercase">Meios de Pagamento</h2>
                <div id="payments" class="w-full h-[180px]"></div>
            </div>
        </div>
    </div>

    <div class="mrk-card p-6">
        <h2 class="text-md font-bold mb-4 uppercase">Faturamento por Horário (Média)</h2>
        <div id="chartFaturamentoHora" style="width: 100%; height: 400px;"></div>
    </div>
</div>

<script>
    'use strict';

    const baseUrl = window.location.hostname !== 'localhost' ? 'https://portal.mrksolucoes.com.br/api/v1/index.php' : 'http://localhost/portal-mrk/api/v1/index.php';
    const urlParams = new URLSearchParams(window.location.search);
    const system_unit_id = parseInt(urlParams.get('system_unit_id')), user_id = parseInt(urlParams.get('user_id')), token = urlParams.get('token');

    let grupoId = null, resumoPorGrupo = [], resumoDiarioGrupo = [], modosVendaGrupo = [], meiosPagamentoGrupo = [], rankingDataGrupo = [], faturamentoHoraGrupo = [], horasGrupo = [];
    let isMaisVendidos = true, isTipoQuantidade = true, mrkPalette = ['#0B46AC', '#2e7d32', '#ffa000', '#d32f2f', '#673ab7'];

    function animateValue(id, start, end, duration, isCurrency = false) {
        const obj = document.getElementById(id); if (!obj) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const value = start + progress * (end - start);
            obj.textContent = isCurrency ? value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) : Math.floor(value);
            if (progress < 1) window.requestAnimationFrame(step);
        };
        window.requestAnimationFrame(step);
    }

    function setRange(tipo) {
        const now = new Date(), start = new Date();
        if (tipo === 'ontem') start.setDate(now.getDate() - 1);
        else if (tipo === '7dias') start.setDate(now.getDate() - 7);
        else if (tipo === 'mes') start.setMonth(now.getMonth() - 1);
        document.getElementById('endDate').value = now.toISOString().split('T')[0];
        document.getElementById('startDate').value = start.toISOString().split('T')[0];
        fetchData();
    }

    async function fetchData() {
        const start = document.getElementById('startDate').value, end = document.getElementById('endDate').value;
        const dt_inicio = start + ' 00:00:00', dt_fim = end + ' 23:59:59';

        $('.kanit').addClass('skeleton');

        try {
            await carregarLojasGrupo();
            const results = await Promise.all([
                axios.post(baseUrl, { method: 'generateResumoFinanceiroPorGrupo', token, data: { grupoId, dt_inicio, dt_fim } }),
                axios.post(baseUrl, { method: 'generateResumoFinanceiroPorGrupoDiario', token, data: { grupoId, dt_inicio, dt_fim } }),
                axios.post(baseUrl, { method: 'getResumoModosVendaPorGrupo', token, data: { grupoId, dt_inicio, dt_fim } }),
                axios.post(baseUrl, { method: 'getResumoMeiosPagamentoPorGrupo', token, data: { grupoId, dt_inicio, dt_fim } }),
                axios.post(baseUrl, { method: 'getRankingVendasProdutosPorGrupo', token, data: { grupoId, dt_inicio, dt_fim } }),
                axios.post(baseUrl, { method: 'generateHourlySalesByGrupo', token, data: { grupoId, dt_inicio, dt_fim } })
            ]);

            resumoPorGrupo = results[0].data.data;
            resumoDiarioGrupo = results[1].data.data;
            modosVendaGrupo = results[2].data.data;
            meiosPagamentoGrupo = results[3].data.data;
            rankingDataGrupo = results[4].data.data;
            horasGrupo = results[5].data.horas;
            faturamentoHoraGrupo = results[5].data.lojas;

            $('.kanit').removeClass('skeleton');
            aplicarFiltroLoja();
        } catch (err) { Swal.fire('Erro', 'Falha ao carregar dados.', 'error'); }
    }

    function aplicarFiltroLoja() {
        const selected = $('#filtroLoja').val() || [];
        const f = l => selected.length === 0 || selected.includes(l.lojaId || l.custom_code);

        renderResumo(resumoPorGrupo.filter(f));
        renderResumoDiario(resumoDiarioGrupo.filter(f));
        renderChartModosVenda(modosVendaGrupo.filter(f)); // <--- CORREÇÃO: Enviando dados de modos
        renderDonutLojas(resumoPorGrupo.filter(f));
        renderRanking(rankingDataGrupo.filter(f));
        renderMeiosPagamento(meiosPagamentoGrupo.filter(f));
        renderChartHora(faturamentoHoraGrupo.filter(f));
    }

    // ====== FUNÇÃO DO GRÁFICO CORRIGIDA ======
    function renderChartModosVenda(data) {
        const chart = echarts.init(document.getElementById('chartModosVenda'));
        const agregados = {};

        data.forEach(loja => {
            loja.data.forEach(mod => {
                if (!agregados[mod.modoVenda]) agregados[mod.modoVenda] = { quantidade: 0, valor: 0 };
                agregados[mod.modoVenda].quantidade += mod.quantidade;
                agregados[mod.modoVenda].valor += parseFloat(mod.valor);
            });
        });

        chart.setOption({
            color: mrkPalette,
            tooltip: { trigger: 'item', formatter: '<b>{b}</b><br>R$ {c}<br>{d}%' },
            legend: { bottom: 0, icon: 'circle', textStyle: { fontSize: 10 } },
            series: [{
                type: 'pie', radius: ['40%', '70%'], avoidLabelOverlap: false,
                itemStyle: { borderRadius: 8, borderColor: '#fff', borderWidth: 2 },
                label: { show: false },
                data: Object.entries(agregados).map(([k, v]) => ({ name: k, value: v.valor, quantidade: v.quantidade }))
            }]
        });
    }

    // Outros renders simplificados para o exemplo
    function renderResumo(data) {
        let b=0, d=0, t=0, l=0, c=0;
        data.forEach(x => { b+=parseFloat(x.faturamento_bruto); d+=parseFloat(x.descontos); t+=parseFloat(x.taxa_servico); l+=parseFloat(x.faturamento_liquido); c+=parseInt(x.numero_clientes); });
        animateValue('faturamentoTotal', 0, b, 800, true);
        animateValue('descontos', 0, d, 800, true);
        animateValue('taxaServico', 0, t, 800, true);
        animateValue('faturamentoLiquido', 0, l, 800, true);
        animateValue('numClientes', 0, c, 800);
        animateValue('ticketMedio', 0, c > 0 ? b/c : 0, 800, true);
    }

    function renderResumoDiario(lojas) {
        const chartDom = document.getElementById('chartFaturamentoDiario');
        const myChart = echarts.init(chartDom);

        const datas = new Set();
        const totaisPorData = {};

        // Agregação dos dados por data contabil
        lojas.forEach(loja => {
            loja.data.forEach(d => {
                const dia = d.dataContabil;
                datas.add(dia);
                if (!totaisPorData[dia]) {
                    totaisPorData[dia] = { liquido: 0, taxa: 0, desconto: 0 };
                }
                totaisPorData[dia].liquido += parseFloat(d.faturamento_liquido || 0);
                totaisPorData[dia].taxa += parseFloat(d.taxa_servico || 0);
                totaisPorData[dia].desconto += parseFloat(d.descontos || 0);
            });
        });

        const orderedDatas = Array.from(datas).sort();
        const seriesLiquido = orderedDatas.map(d => totaisPorData[d].liquido);
        const seriesTaxa = orderedDatas.map(d => totaisPorData[d].taxa);
        const seriesDesconto = orderedDatas.map(d => totaisPorData[d].desconto);

        const option = {
            color: ['#0B46AC', '#ffa000', '#d32f2f'], // Azul MRK, Amber, Red
            tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'shadow' },
                formatter: function (params) {
                    let total = 0;
                    let detalhes = params.map(item => {
                        total += item.value;
                        return `<span style="display:inline-block;width:10px;height:10px;background:${item.color};margin-right:4px;border-radius:50%"></span>
                            ${item.seriesName}: <b>${item.value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</b>`;
                    }).join('<br>');

                    const dataFmt = params[0].axisValue.split('-').reverse().join('/');
                    return `<b>Data: ${dataFmt}</b><br>${detalhes}<hr style="margin:5px 0; border-top:1px solid #eee;"><b>Total Bruto: ${total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</b>`;
                }
            },
            legend: { top: 0, icon: 'roundRect', textStyle: { fontFamily: 'Poppins' } },
            grid: { left: '3%', right: '4%', bottom: '5%', containLabel: true },
            xAxis: {
                type: 'category',
                data: orderedDatas,
                axisLabel: { formatter: (v) => v.split('-').reverse().slice(0,2).join('/') } // Mostra apenas DD/MM
            },
            yAxis: {
                type: 'value',
                axisLabel: { formatter: (v) => v.toLocaleString('pt-BR', { compactDisplay: 'short', notation: 'compact' }) }
            },
            series: [
                {
                    name: 'Faturamento Líquido',
                    type: 'bar',
                    stack: 'total', // Faz as barras ficarem uma sobre a outra
                    emphasis: { focus: 'series' },
                    data: seriesLiquido,
                    itemStyle: { borderRadius: [0, 0, 4, 4] }
                },
                {
                    name: 'Taxa de Serviço',
                    type: 'bar',
                    stack: 'total',
                    emphasis: { focus: 'series' },
                    data: seriesTaxa
                },
                {
                    name: 'Descontos',
                    type: 'bar',
                    stack: 'total',
                    emphasis: { focus: 'series' },
                    data: seriesDesconto,
                    itemStyle: { borderRadius: [4, 4, 0, 0] }
                }
            ]
        };

        myChart.setOption(option);
    }

    function renderDonutLojas(data) {
        const chart = echarts.init(document.getElementById('main'));
        const ds = data.map(l => ({ name: l.nomeLoja, value: parseFloat(l.faturamento_bruto) })).sort((a,b) => b.value - a.value).slice(0, 10);
        chart.setOption({
            color: mrkPalette,
            tooltip: { trigger: 'item' },
            legend: { bottom: 0 },
            series: [{ type: 'pie', radius: ['40%', '70%'], data: ds, itemStyle: { borderRadius: 10, borderColor: '#fff', borderWidth: 2 } }]
        });
    }

    function renderMeiosPagamento(data) {
        const chart = echarts.init(document.getElementById('payments'));
        const agregados = {};

        // Agregação dos valores por meio de pagamento
        data.forEach(l => l.data.forEach(p => {
            const n = p.nome.trim();
            agregados[n] = (agregados[n] || 0) + parseFloat(p.valor);
        }));

        // Ordena do maior para o menor e pega os 5 principais
        const ds = Object.entries(agregados).sort((a, b) => b[1] - a[1]).slice(0, 5);

        chart.setOption({
            tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'shadow' },
                formatter: (params) => {
                    const val = params[0].value;
                    return `<b>${params[0].name}</b><br>Total: ${val.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
                }
            },
            grid: { top: 10, bottom: 20, left: '3%', right: '25%', containLabel: true },
            xAxis: { type: 'value', show: false },
            yAxis: {
                type: 'category',
                data: ds.map(x => x[0]),
                axisLine: { show: false },
                axisTick: { show: false },
                axisLabel: { fontFamily: 'Poppins', fontSize: 11 }
            },
            series: [{
                type: 'bar',
                data: ds.map(x => x[1]),
                color: '#ffa000', // Padrão Amber MRK
                label: {
                    show: true,
                    position: 'right',
                    // Máscara de valor monetário na ponta da barra
                    formatter: (p) => p.value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }),
                    fontSize: 10,
                    fontWeight: 'bold',
                    fontFamily: 'Kanit',
                    color: '#333'
                },
                itemStyle: { borderRadius: [0, 4, 4, 0] }
            }]
        });
    }

    function renderRanking(data) {
        const type = isTipoQuantidade ? 'quantidade' : 'valor', side = isMaisVendidos ? 'mais' : 'menos';
        const key = `${side}_vendidos_${type}`, agregados = {};
        data.forEach(l => (l[key] || []).forEach(i => {
            if(!agregados[i.cod_material]) agregados[i.cod_material] = { n: i.nome_produto, q: 0, v: 0 };
            agregados[i.cod_material].q += parseFloat(i.total_quantidade); agregados[i.cod_material].v += parseFloat(i.total_valor);
        }));
        const ds = Object.values(agregados).sort((a, b) => isMaisVendidos ? b[isTipoQuantidade ? 'q' : 'v'] - a[isTipoQuantidade ? 'q' : 'v'] : a[isTipoQuantidade ? 'q' : 'v'] - b[isTipoQuantidade ? 'q' : 'v']).slice(0, 10);
        document.getElementById('rankingTableBody').innerHTML = ds.map((x, i) => `<tr class="border-b"><td class="p-2">${i+1}</td><td class="p-2">${x.n}</td><td class="p-2 text-right font-bold">${isTipoQuantidade ? x.q : 'R$ ' + x.v.toLocaleString()}</td></tr>`).join('');
        document.getElementById('headerTipo').textContent = isTipoQuantidade ? 'Qtd' : 'Valor (R$)';
    }

    function renderChartHora(lojas) {
        const chart = echarts.init(document.getElementById('chartFaturamentoHora'));
        chart.setOption({
            color: mrkPalette, tooltip: { trigger: 'axis' }, legend: { bottom: 0 },
            xAxis: { type: 'category', boundaryGap: false, data: horasGrupo },
            yAxis: { type: 'value' },
            series: lojas.map(l => ({ name: l.nome, type: 'line', smooth: true, areaStyle: { opacity: 0.1 }, data: l.valores }))
        });
    }

    async function carregarLojasGrupo() {
        const res = await axios.post(baseUrl, { method: 'getUnitsByGroup', token, data: { group_id: grupoId } });
        const filter = $('#filtroLoja').empty();
        res.data.forEach(l => filter.append(new Option(l.name, l.custom_code)));
        filter.trigger('change.select2');
    }

    async function carregarGrupoInicial() {
        const res = await axios.post(baseUrl, { method: 'getGroupByUnit', token, data: { system_unit_id } });
        if (res.data?.length > 0) grupoId = res.data[0].id;
        const resGroups = await axios.post(baseUrl, { method: 'getGroupByUser', token, data: { user_id } });
        const sel = document.getElementById('filtroGrupo');
        sel.innerHTML = resGroups.data.grupos.map(g => `<option value="${g.id}" ${g.id == grupoId ? 'selected' : ''}>${g.nome}</option>`).join('');
        sel.addEventListener('change', () => { grupoId = parseInt(sel.value); fetchData(); });
    }

    $(document).ready(async () => {
        $('#filtroLoja').select2({ placeholder: 'Lojas...', allowClear: true });
        $('#filtroLoja').on('change', aplicarFiltroLoja);

        const toggleBtn = (id, others) => {
            document.getElementById(id).classList.add('bg-blue-700', 'text-white');
            others.forEach(o => document.getElementById(o).classList.remove('bg-blue-700', 'text-white'));
            aplicarFiltroLoja();
        };
        document.getElementById('btnMais').onclick = () => { isMaisVendidos = true; toggleBtn('btnMais', ['btnMenos']); };
        document.getElementById('btnMenos').onclick = () => { isMaisVendidos = false; toggleBtn('btnMenos', ['btnMais']); };
        document.getElementById('btnQtd').onclick = () => { isTipoQuantidade = true; toggleBtn('btnQtd', ['btnValor']); };
        document.getElementById('btnValor').onclick = () => { isTipoQuantidade = false; toggleBtn('btnValor', ['btnQtd']); };

        await carregarGrupoInicial();
        setRange('7dias');
    });
</script>
</body>
</html>